#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D lineTexture;
uniform sampler2D colorTexture;
uniform float radiusHeightScale;

uniform float radius;
uniform float complexity;
uniform float color;
uniform float colorCenter;
uniform float colorCenterRatio;
uniform vec4  colorOverride;
uniform float brightness;
uniform float alpha;
uniform float opacity;
uniform float index;
uniform float lineType;

varying vec2 vTexCoord;

void main() {
  vec2 lineTextureScale = vec2(floor(150.0 * radius * (1.0 + complexity)), 1.0);
  vec4 linePattern = texture2D(lineTexture, (1.0 - lineType) * vTexCoord * lineTextureScale);
  vec4 lineColorOutside  = texture2D(colorTexture, vec2(color, 0.5));
  vec4 lineColorCenter  = texture2D(colorTexture, vec2(colorCenter, 0.5));



  //0....ratio.....1
  //0    1         1
  float k = 1.0;
  float ratio = 2.0 * colorCenterRatio;
  if (index < ratio && ratio > 0.0) {
    k = index / ratio;
  }
  vec4 lineColor = mix(lineColorCenter, lineColorOutside, k);

  if (color < 0.0) {
      lineColor = vec4(1.0);
  }

  gl_FragColor = linePattern * lineColor;

  gl_FragColor *= alpha * brightness * opacity;
}
